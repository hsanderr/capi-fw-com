\doxysection{C\+:/\+Users/\+P/\+Documents/\+Projeto\+\_\+\+Comedouro\+\_\+\+PIPE/comeint-\/fw/feeder-\/fw/components/app\+\_\+measure\+\_\+vcc/app\+\_\+measure\+\_\+vcc.c File Reference}
\hypertarget{app__measure__vcc_8c}{}\label{app__measure__vcc_8c}\index{C:/Users/P/Documents/Projeto\_Comedouro\_PIPE/comeint-\/fw/feeder-\/fw/components/app\_measure\_vcc/app\_measure\_vcc.c@{C:/Users/P/Documents/Projeto\_Comedouro\_PIPE/comeint-\/fw/feeder-\/fw/components/app\_measure\_vcc/app\_measure\_vcc.c}}


Contains code (buttons and LEDs) to measure the battery voltage.  


{\ttfamily \#include "{}esp\+\_\+log.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+err.\+h"{}}\newline
{\ttfamily \#include "{}esp\+\_\+adc/adc\+\_\+oneshot.\+h"{}}\newline
{\ttfamily \#include "{}freertos/\+Free\+RTOS.\+h"{}}\newline
{\ttfamily \#include "{}freertos/task.\+h"{}}\newline
{\ttfamily \#include "{}freertos/queue.\+h"{}}\newline
{\ttfamily \#include "{}app\+\_\+measure\+\_\+vcc.\+h"{}}\newline
{\ttfamily \#include "{}app\+\_\+status.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{app__measure__vcc_8c_a5155a7b7465dd9b5e6167122827d0158}\label{app__measure__vcc_8c_a5155a7b7465dd9b5e6167122827d0158} 
\#define {\bfseries LOG\+\_\+\+LOCAL\+\_\+\+LEVEL}~ESP\+\_\+\+LOG\+\_\+\+NONE
\item 
\Hypertarget{app__measure__vcc_8c_a69772b185b52d35cd012081c8e22e6a3}\label{app__measure__vcc_8c_a69772b185b52d35cd012081c8e22e6a3} 
\#define {\bfseries VOLTAGE\+\_\+\+MEAS\+\_\+\+AVG\+\_\+\+ARR\+\_\+\+SIZE}~10
\begin{DoxyCompactList}\small\item\em Voltage measurements average array size. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static esp\+\_\+err\+\_\+t \mbox{\hyperlink{app__measure__vcc_8c_a510dbfcc6e6cbddf781fbc948d847922}{app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+calibrate\+\_\+adc}} (adc\+\_\+unit\+\_\+t unit, adc\+\_\+channel\+\_\+t channel, adc\+\_\+atten\+\_\+t atten, adc\+\_\+cali\+\_\+handle\+\_\+t \texorpdfstring{$\ast$}{*}out\+\_\+handle)
\begin{DoxyCompactList}\small\item\em Calibrate ADC. \end{DoxyCompactList}\item 
static void \mbox{\hyperlink{app__measure__vcc_8c_a57b1c247b9247c054a187c59fb93465e}{app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+adc\+\_\+read\+\_\+task}} (void \texorpdfstring{$\ast$}{*}args)
\begin{DoxyCompactList}\small\item\em Task to perform the ADC readings. \end{DoxyCompactList}\item 
esp\+\_\+err\+\_\+t \mbox{\hyperlink{app__measure__vcc_8c_ada9422589e186cb2217a886f6cb48431}{app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+init}} (void)
\begin{DoxyCompactList}\small\item\em Initialize VCC measurement. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{app__measure__vcc_8c_a5a85b9c772bbeb480b209a3e6ea92b4c}\label{app__measure__vcc_8c_a5a85b9c772bbeb480b209a3e6ea92b4c} 
static const char \texorpdfstring{$\ast$}{*} {\bfseries TAG} = "{}app\+\_\+measure\+\_\+vcc"{}
\begin{DoxyCompactList}\small\item\em Tag to be used when logging. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_a574554647b831c66115ed6322e1faae4}\label{app__measure__vcc_8c_a574554647b831c66115ed6322e1faae4} 
static adc\+\_\+oneshot\+\_\+unit\+\_\+handle\+\_\+t {\bfseries adc\+\_\+handle}
\begin{DoxyCompactList}\small\item\em ADC handle. \end{DoxyCompactList}\item 
static adc\+\_\+oneshot\+\_\+unit\+\_\+init\+\_\+cfg\+\_\+t \mbox{\hyperlink{app__measure__vcc_8c_a1bb47813531c87451be5ac991a3efae2}{init\+\_\+config}}
\begin{DoxyCompactList}\small\item\em ADC initialization configuration. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_a592f72af7f896d9d94d01e04687e1d96}\label{app__measure__vcc_8c_a592f72af7f896d9d94d01e04687e1d96} 
static adc\+\_\+cali\+\_\+handle\+\_\+t {\bfseries adc\+\_\+cal\+\_\+handle} = NULL
\begin{DoxyCompactList}\small\item\em ADC calibration handle. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_a725e6d28b6b941f243806cdb04c33988}\label{app__measure__vcc_8c_a725e6d28b6b941f243806cdb04c33988} 
uint8\+\_\+t {\bfseries calibration\+\_\+successful} = 0
\begin{DoxyCompactList}\small\item\em Flag to indicate if calibration was successful. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_af70615c12f9753356a80be215518ea93}\label{app__measure__vcc_8c_af70615c12f9753356a80be215518ea93} 
int {\bfseries voltage\+\_\+measurements} \mbox{[}\mbox{\hyperlink{app__measure__vcc_8c_a69772b185b52d35cd012081c8e22e6a3}{VOLTAGE\+\_\+\+MEAS\+\_\+\+AVG\+\_\+\+ARR\+\_\+\+SIZE}}\mbox{]} = \{0\}
\begin{DoxyCompactList}\small\item\em Array to store voltage measurements to calculate average. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_a71dd84378e3e951d83688c6b48ce5782}\label{app__measure__vcc_8c_a71dd84378e3e951d83688c6b48ce5782} 
int {\bfseries voltage\+\_\+measurements\+\_\+index} = 0
\begin{DoxyCompactList}\small\item\em Index to keep track of the current measurement. \end{DoxyCompactList}\item 
\Hypertarget{app__measure__vcc_8c_a1f02e73d94c30d8e8f61147c57c59cc1}\label{app__measure__vcc_8c_a1f02e73d94c30d8e8f61147c57c59cc1} 
static Task\+Handle\+\_\+t {\bfseries app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+adc\+\_\+read\+\_\+task\+\_\+handle} = NULL
\begin{DoxyCompactList}\small\item\em Read ADC task handle. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Contains code (buttons and LEDs) to measure the battery voltage. 

\begin{DoxyAuthor}{Author}
Henrique Sander Louren√ßo (\href{mailto:henriquesander27@gmail.com}{\texttt{ henriquesander27@gmail.\+com}}) 
\end{DoxyAuthor}
\begin{DoxyVersion}{Version}
0.\+1 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
2024-\/03-\/23
\end{DoxyDate}
\begin{DoxyCopyright}{Copyright}
Copyright (c) 2024 Pet\+Dog
\end{DoxyCopyright}
Copyright 2024 Pet\+Dog

Licensed under the Apache License, Version 2.\+0 (the "{}\+License"{}); you may not use this file except in compliance with the License. You may obtain a copy of the License at \begin{DoxyVerb}http://www.apache.org/licenses/LICENSE-2.0
\end{DoxyVerb}
 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "{}\+AS IS"{} BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\textquotesingle{} See the License for the specific language governing permissions and limitations under the License. 

\doxysubsection{Function Documentation}
\Hypertarget{app__measure__vcc_8c_a57b1c247b9247c054a187c59fb93465e}\label{app__measure__vcc_8c_a57b1c247b9247c054a187c59fb93465e} 
\index{app\_measure\_vcc.c@{app\_measure\_vcc.c}!app\_measure\_vcc\_\_adc\_read\_task@{app\_measure\_vcc\_\_adc\_read\_task}}
\index{app\_measure\_vcc\_\_adc\_read\_task@{app\_measure\_vcc\_\_adc\_read\_task}!app\_measure\_vcc.c@{app\_measure\_vcc.c}}
\doxysubsubsection{\texorpdfstring{app\_measure\_vcc\_\_adc\_read\_task()}{app\_measure\_vcc\_\_adc\_read\_task()}}
{\footnotesize\ttfamily static void app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+adc\+\_\+read\+\_\+task (\begin{DoxyParamCaption}\item[{void \texorpdfstring{$\ast$}{*}}]{args }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Task to perform the ADC readings. 


\begin{DoxyParams}{Parameters}
{\em args} & Optional argument (not being used). \\
\hline
\end{DoxyParams}
\Hypertarget{app__measure__vcc_8c_a510dbfcc6e6cbddf781fbc948d847922}\label{app__measure__vcc_8c_a510dbfcc6e6cbddf781fbc948d847922} 
\index{app\_measure\_vcc.c@{app\_measure\_vcc.c}!app\_measure\_vcc\_\_calibrate\_adc@{app\_measure\_vcc\_\_calibrate\_adc}}
\index{app\_measure\_vcc\_\_calibrate\_adc@{app\_measure\_vcc\_\_calibrate\_adc}!app\_measure\_vcc.c@{app\_measure\_vcc.c}}
\doxysubsubsection{\texorpdfstring{app\_measure\_vcc\_\_calibrate\_adc()}{app\_measure\_vcc\_\_calibrate\_adc()}}
{\footnotesize\ttfamily static esp\+\_\+err\+\_\+t app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+calibrate\+\_\+adc (\begin{DoxyParamCaption}\item[{adc\+\_\+unit\+\_\+t}]{unit,  }\item[{adc\+\_\+channel\+\_\+t}]{channel,  }\item[{adc\+\_\+atten\+\_\+t}]{atten,  }\item[{adc\+\_\+cali\+\_\+handle\+\_\+t \texorpdfstring{$\ast$}{*}}]{out\+\_\+handle }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}



Calibrate ADC. 


\begin{DoxyParams}{Parameters}
{\em unit} & ADC unit. \\
\hline
{\em channel} & ADC channel. \\
\hline
{\em atten} & ADC attenuation. \\
\hline
{\em out\+\_\+handle} & Output calibration handle, used to store the calibration data and convert the raw reading values to voltage. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
esp\+\_\+err\+\_\+t 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em ESP\+\_\+\+OK} & if calibration is successful. \\
\hline
{\em ESP\+\_\+\+FAIL} & otherwise. \\
\hline
\end{DoxyRetVals}
\Hypertarget{app__measure__vcc_8c_ada9422589e186cb2217a886f6cb48431}\label{app__measure__vcc_8c_ada9422589e186cb2217a886f6cb48431} 
\index{app\_measure\_vcc.c@{app\_measure\_vcc.c}!app\_measure\_vcc\_\_init@{app\_measure\_vcc\_\_init}}
\index{app\_measure\_vcc\_\_init@{app\_measure\_vcc\_\_init}!app\_measure\_vcc.c@{app\_measure\_vcc.c}}
\doxysubsubsection{\texorpdfstring{app\_measure\_vcc\_\_init()}{app\_measure\_vcc\_\_init()}}
{\footnotesize\ttfamily esp\+\_\+err\+\_\+t app\+\_\+measure\+\_\+vcc\+\_\+\+\_\+init (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}



Initialize VCC measurement. 

\begin{DoxyReturn}{Returns}
esp\+\_\+err\+\_\+t 
\end{DoxyReturn}

\begin{DoxyRetVals}{Return values}
{\em ESP\+\_\+\+OK} & if VCC measurement is successfully initialized. \\
\hline
{\em ESP\+\_\+\+FAIL} & otherwise. \\
\hline
\end{DoxyRetVals}


\doxysubsection{Variable Documentation}
\Hypertarget{app__measure__vcc_8c_a1bb47813531c87451be5ac991a3efae2}\label{app__measure__vcc_8c_a1bb47813531c87451be5ac991a3efae2} 
\index{app\_measure\_vcc.c@{app\_measure\_vcc.c}!init\_config@{init\_config}}
\index{init\_config@{init\_config}!app\_measure\_vcc.c@{app\_measure\_vcc.c}}
\doxysubsubsection{\texorpdfstring{init\_config}{init\_config}}
{\footnotesize\ttfamily adc\+\_\+oneshot\+\_\+unit\+\_\+init\+\_\+cfg\+\_\+t init\+\_\+config\hspace{0.3cm}{\ttfamily [static]}}

{\bfseries Initial value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{=\ \{}
\DoxyCodeLine{\ \ \ \ .unit\_id\ =\ ADC\_UNIT\_1,}
\DoxyCodeLine{\}}

\end{DoxyCode}


ADC initialization configuration. 

